---
title: "Splunk 2"
date: 2022-03-29T19:11:39+02:00
draft: false
---

This write up refers to the [Splunk 2](https://tryhackme.com/room/splunk2gcd5) room on [TryHackMe](https://tryhackme.com/).

In [Splunk 101](https://tryhackme.com/room/splunk101) we were taught the very basics of how to install and use Splunk. Now it's time to tackle som real challenges!

#### Task 1: Deploy!

This room works with data generated by members of Splunk's Security Specialist team based on version 2 of the Boss of the SOC (BOTS) competition by Splunk.

[BOTSv2 Github](https://github.com/splunk/botsv2)

##### Question 1

Deploy the attached VM and connect to it via `http://<vm_ip>:8000`. Then click the `Completed` button.

#### Task 2: Dive into the data

We are roleplaying as Alice Bluebird, an analyst who successfully assisted Wayne Enterprises and was recommended to Grace Hoppy at Frothly to assist them with their recent issues.

To find out what events we are dealing with use the `metadata` command to search for the same kind of information found in the Data Summary, while also being able to search within a specific index. Since all time-values are EPOCH time we also need the `eval` command to provide more human-friendly formatting.

The following example searches the botsv2 index and returns a listing of all the source types that can be found as well as a count of events and the first time and last time seen.

`| metadata type=sourcetypes index=botsv2 | eval firstTime=strftime(firstTime,"%Y-%m-%d %H:%M:%S") | eval lastTime=strftime(lastTime,"%Y-%m-%d %H:%M:%S") | eval recentTime=strftime(recentTime,"%Y-%m-%d %H:%M:%S") | sort - totalCount`

##### Question 2

Click the `Completed` button.

#### Task 3: 100 series questions

For now we focus on BOTSv2 questions 100-104. Our focus is a person called Amber Turing and her communication with a competitor.

**Question 1:**

Find out what competitor website she visited. Begin with the following command to search for Amber's IP address `index="botsv2" amber`. This command will produce a lot of events though you can find her IP in the first page. However, to get her IP easily try this `index = "botsv2" sourcetype="pan:traffic" amber`. This gives us `10.0.2.101` as her IP.

Given this information we can build new search queries and focus on her HTTP traffic like this `index = "botsv2" IPADDR sourcetype="stream:HTTP"`.

However, this still produces a lot of results to go through just to find the website of the competitor she was looking at. Let's try narrowing it down a bit further by making use of the `site` field and displaying the output in a table like so `index="botsv2" IPADDR sourcetype="stream:HTTP" | dedup site | table site`.

With this search it should be easy to find the website Amber connected to, just think about which company Amber works for and in which industry branch. You can even narrow it down further `index="botsv2" IPADDR sourcetype="stream:HTTP" *INDUSTRY* | dedup site | table site` giving us `www.berkbeer.com`

**Question 2-7:**

We now know that Amber found the executive contact information and sent him an email. Based on question 2, it has to be an image. With this knowledge it is easy to construct a new query to narrow down Amber's HTTP traffic to the competitor website.

`index="botsv2" IPADDR sourcetype="stream:HTTP" COMPETITOR_WEBSITE`

Expand on this command to get the specific field we want and output it in table format as previously

Try `index="botsv2" IPADDR sourcetype="stream:HTTP" COMPETITOR_WEBSITE /images/* |  table uri_path` to get `/images/ceoberk.png`.

Now we need Amber's email to look at the SMTP traffic between her and the CEO of berkbeer. Try `index="botsv2" sourcetype="stream::SMTP" *amber*`, giving us `aturing@froth.ly` as her email.

We have the last name of the CEO and Amber's email, to get his full name however we need to focus on the email traffic between Amber and the CEO. Try this command `index="botsv2" sourcetype="stream:SMTP" AMBERS_EMAIL COMPETITOR_WEBSITE`. Paying attention to the email conversation by looking at the `content_body` header reveals his full name `Martin Berk`.

With all this information we can solve the challenges attached to this task.

##### Question 3) Amber Turing was hoping for Frothly to be acquired by a potential competitor which fell through, but visited their website to find contact information for their executive team. What is the website domain that she visited?

**Solution:** www.berkbeer.com

##### Question 4) Amber found the executive contact information and sent him an email. What image file displayed the executive's contact information? Answer example: /path/image.ext

**Solution:** /images/ceoberk.png

*All following questions are answered by looking through the email conversation.*
##### Question 5) What is the CEO's name? Provide the first and last name.

**Solution:** Martin Berk

##### Question 6) What is the CEO's email address?

**Solution:** mberk@berkbeer.com

##### Question 7) After the initial contact with the CEO, Amber contacted another employee at this competitor. What is the employee's email address?

**Solution:** abernhard@berkbeer.com

##### Question 8) What is the name of the file attachment that Amber sent to a contact at the competitor?

**Solution:** Saccharomyces_cerevisiae_patent.docx 

##### Question 9) What is Amber's personal email address?

The content of the email this is discussed in is encoded in base64, you need to decode it first to get the solution.

**Solution:** ambersthebest@yeastiebeastie.com



